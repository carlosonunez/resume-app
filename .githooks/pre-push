#!/bin/sh
# Ensure that our tests pass before pushing changes to our remote.
# We can override this by prefixing our HEAD commit with: "[FORCE COMMIT]"

echo "INFO: Running pre-push tests. Please wait a moment."
if ! git log --pretty=format:"%s" -n 1 HEAD | grep -qE "^\[FORCE COMMIT\] "
then
  export UPDATE_TRAVIS=1
  if ! make test
  then
    echo "ERROR: Tests failed! If this is intentional, include \"[FORCE COMMIT]\" \
to the beginning of your commit message." >&2
    exit 1
  fi
fi

echo "INFO: All tests passed! Updating version prior to push."
make tag
